from SocketServer import ThreadingUDPServer, DatagramRequestHandler
from src.KThread  import *

MALWARE_CENTER_IP   = "1.2.1.1"
MALWARE_CENTER_PORT = 56566



class Malware_request_handler( DatagramRequestHandler ):
    ''' Class of Malware request handler.

    TODO
    '''
    def handle(self):
        '''Handle requests to Malware Center server.
        '''
        data = self.rfile.read()
        print("new worm instance " + str(data))


def start_malware_center(ip="localhost", port=56565):
    '''Starts Malware Center.

    Args:
        ip: IP address of Malware Center server.
        port: port of Malware Center server.
    '''
    server = ThreadingUDPServer((ip, port), Malware_request_handler)
    server.allow_reuse_address = True
    print("server started\n")
    server.serve_forever()


if __name__ == "__main__":
    server_thread = KThread(target=start_malware_center, args=(MALWARE_CENTER_IP,MALWARE_CENTER_PORT))
#    server_thread.daemon = True
    server_thread.start()
#    server_thread.kill()








